{% comment %}
  sections/circle-image.liquid
{% endcomment %}

<div
  class="circle-image-section circle-image-section-{{ section.id }}"
  style="
    --circle-diameter: {{ section.settings.banner_height | default: 260 }}px;
    --banner-border-color: {{ section.settings.banner_border_color | default: '#f4e4cd' }};
    --banner-pos-x: {{ section.settings.banner_pos_x | default: 50 }}%;
    --banner-pos-y: {{ section.settings.banner_pos_y | default: 50 }}%;
    --circle-margin-top: {{ section.settings.circle_margin_top | default: 80 }}px;
    --circle-margin-bottom: {{ section.settings.circle_margin_bottom | default: 40 }}px;
    --overlay-text-color: {{ section.settings.text_color | default: '#ffffff' }};
    --overlay-text-size: {{ section.settings.text_size | default: 36 }}px;
    --overlay-subtext-size: {{ section.settings.subtitle_size | default: 18 }}px;
  "
>
  <div class="circle-image-container">
    {% if section.settings.link != blank %}
      <a href="{{ section.settings.link }}" class="circle-link-wrapper">
    {% endif %}

    <div class="circle-frame">
      {% if section.settings.image != blank %}
        {{
          section.settings.image
          | image_url: width: 800
          | image_tag:
            class: 'circle-image',
            alt: section.settings.alt_text,
            loading: 'lazy'
        }}
      {% else %}
        <div class="circle-placeholder">
          Upload an image in the section settings
        </div>
      {% endif %}

      {% if section.settings.title != blank %}
        <div class="circle-overlay-text">
          <div class="circle-title">{{ section.settings.title }}</div>
          {% if section.settings.subtitle != blank %}
            <div class="circle-subtitle">{{ section.settings.subtitle }}</div>
          {% endif %}
        </div>
      {% endif %}
    </div>

    {% if section.settings.link != blank %}
      </a>
    {% endif %}
  </div>
</div>

{% style %}
/* Load Cinzel */
@import url('https://fonts.googleapis.com/css2?family=Cinzel:wght@400;500;600;700&display=swap');

/* Scope everything to this section instance */
.circle-image-section-{{ section.id }} {
  position: relative;
  width: 100vw;
  left: 50%;
  right: 50%;
  margin-left: -50vw;
  margin-right: -50vw;

  margin-top: var(--circle-margin-top);
  margin-bottom: var(--circle-margin-bottom);

  background-color: var(--banner-border-color, #f4e4cd);
}

.circle-image-section-{{ section.id }} .circle-image-container {
  width: 100%;
  display: flex;
  align-items: center;
  justify-content: center;

  margin-top: 3rem;
  margin-bottom: -4.9rem;
  padding: 1rem;
}

.circle-image-section-{{ section.id }} .circle-link-wrapper {
  text-decoration: none;
  color: inherit;
}

.circle-image-section-{{ section.id }} .circle-frame {
  width: min(var(--circle-diameter), 80vw);
  height: min(var(--circle-diameter), 80vw);
  border-radius: 50%;
  overflow: hidden;
  position: relative;

  display: flex;
  align-items: center;
  justify-content: center;

  box-shadow:
    rgba(50, 50, 93, 0.25) 0px 30px 60px -20px,
    rgba(0, 0, 0, 0.25) 0px 20px 40px -25px;

  transition:
    transform 0.7s cubic-bezier(.22,1,.36,1),
    box-shadow 0.7s cubic-bezier(.22,1,.36,1);
}

.circle-image-section-{{ section.id }} img.circle-image {
  width: 100% !important;
  height: 100% !important;
  object-fit: cover;
  object-position: var(--banner-pos-x, 50%) var(--banner-pos-y, 50%);
  display: block;
  border-radius: 50%;

  transition: transform 0.9s cubic-bezier(.22,1,.36,1);
}

.circle-image-section-{{ section.id }} .circle-overlay-text {
  position: absolute;
  inset: 0;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  text-align: center;

  padding: 1.2rem;
  pointer-events: none;
}

.circle-image-section-{{ section.id }} .circle-title {
  font-family: 'Cinzel', serif;
  font-size: var(--overlay-text-size, 36px);
  color: var(--overlay-text-color, #ffffff);
  font-weight: 600;
  letter-spacing: 0.12em;
  text-transform: uppercase;
}

.circle-image-section-{{ section.id }} .circle-subtitle {
  margin-top: 0.3rem;
  font-family: 'Cinzel', serif;
  font-size: var(--overlay-subtext-size, 18px);
  color: var(--overlay-text-color, #ffffff);
  opacity: 0.85;
}

.circle-image-section-{{ section.id }} .circle-placeholder {
  width: 100%;
  height: 100%;
  border-radius: 50%;
  background-color: #ffffff33;
  display: flex;
  align-items: center;
  justify-content: center;
  text-align: center;
  padding: 1rem;
}

.circle-image-section-{{ section.id }} .circle-frame:hover {
  transform: translateY(-8px) scale(1.03);
  box-shadow:
    rgba(50, 50, 93, 0.35) 0px 45px 80px -20px,
    rgba(0, 0, 0, 0.35) 0px 30px 60px -30px;
}

.circle-image-section-{{ section.id }} .circle-frame:hover img.circle-image {
  transform: scale(1.05);
}
{% endstyle %}

{% schema %}
{
  "name": "Circle image",
  "settings": [
    { "type": "image_picker", "id": "image", "label": "Circular image" },
    { "type": "text", "id": "alt_text", "label": "Alt text", "default": "Circular image" },
    { "type": "text", "id": "title", "label": "Overlay title", "default": "Your Title" },
    { "type": "text", "id": "subtitle", "label": "Overlay subtitle", "default": "Optional subtitle" },
    { "type": "color", "id": "text_color", "label": "Text color", "default": "#ffffff" },
    { "type": "range", "id": "text_size", "label": "Title text size (px)", "min": 16, "max": 96, "step": 2, "default": 36 },
    { "type": "range", "id": "subtitle_size", "label": "Subtitle text size (px)", "min": 12, "max": 48, "step": 1, "default": 18 },
    { "type": "url", "id": "link", "label": "Optional link" },

    { "type": "header", "content": "Circle size & focus" },
    { "type": "range", "id": "banner_height", "label": "Circle diameter (px)", "min": 150, "max": 700, "step": 10, "default": 260 },
    { "type": "range", "id": "banner_pos_x", "label": "Image focus X (%)", "min": 0, "max": 100, "step": 1, "default": 50 },
    { "type": "range", "id": "banner_pos_y", "label": "Image focus Y (%)", "min": 0, "max": 100, "step": 1, "default": 50 },

    { "type": "header", "content": "Circle spacing" },
    { "type": "range", "id": "circle_margin_top", "label": "Margin top (px)", "min": 0, "max": 200, "step": 4, "default": 40 },
    { "type": "range", "id": "circle_margin_bottom", "label": "Margin bottom (px)", "min": 0, "max": 200, "step": 4, "default": 40 },

    { "type": "header", "content": "Bar color" },
    { "type": "color", "id": "banner_border_color", "label": "Bar color", "default": "#f4e4cd" }
  ],
  "presets": [
    { "name": "Circle image" }
  ]
}
{% endschema %}
